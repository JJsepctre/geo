# 综合结论页面 - 可展开详情设计

## 概述
综合结论页面采用可展开行的设计，点击详情图标后，在该行下方展开显示"处置情况"详细信息，而不是弹出模态窗口。

## ✅ 设计特点

### 1. 展开式交互
- **点击详情图标**：展开该行的详情面板
- **再次点击**：收起详情面板
- **单行展开**：同一时间只能展开一行，点击其他行会自动收起当前展开的行

### 2. 详情面板布局

```
┌─────────────────────────────────────────────────────┐
│  主列表（分段记录码、处置类型、创建时间、处置状态） │
├─────────────────────────────────────────────────────┤
│  ▼ 展开的详情面板                                    │
│  ┌───────────────────────────────────────────────┐  │
│  │ 处置情况                                       │  │
│  │ ┌─────────────────────────────────────────┐   │  │
│  │ │ 处置状态 | 创建时间 | 操作               │   │  │
│  │ │ ─────────────────────────────────────── │   │  │
│  │ │         暂无数据                        │   │  │
│  │ └─────────────────────────────────────────┘   │  │
│  └───────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────┘
```

### 3. 视觉设计

**展开面板样式**:
- 背景颜色：#f7f8fa（浅灰色）
- 内边距：24px
- 圆角：8px
- 外边距：8px 0

**标题"处置情况"**:
- 字体大小：16px
- 字体粗细：600
- 颜色：#1d2129
- 下边距：16px

**内嵌表格**:
- 背景：白色
- 有边框
- 无分页

## 🎯 交互流程

### 用户操作流程
1. 用户浏览综合结论列表
2. 点击某行最右侧的紫色查看图标
3. 该行下方平滑展开，显示"处置情况"面板
4. 面板中显示处置情况的子表格（当前为空数据状态）
5. 再次点击图标或点击其他行，当前展开的面板收起

### 状态管理
```typescript
const [expandedRowKey, setExpandedRowKey] = useState<string | null>(null)

// 点击详情按钮
const handleViewDetail = (record: any) => {
  if (expandedRowKey === record.id) {
    setExpandedRowKey(null) // 收起
  } else {
    setExpandedRowKey(record.id) // 展开
  }
}
```

## 📊 详情面板内容

### 处置情况表格列

| 列名 | 数据字段 | 宽度 | 说明 |
|------|----------|------|------|
| 处置状态 | status | 200px | 处置状态信息 |
| 创建时间 | createTime | 300px | 创建时间 |
| 操作 | operation | 150px | 三点菜单图标 |

### 操作图标
使用三点垂直菜单图标（···）：
```svg
<svg width="16" height="16">
  <circle cx="8" cy="8" r="1.5" fill="#86909c"/>
  <circle cx="8" cy="12" r="1.5" fill="#86909c"/>
  <circle cx="8" cy="4" r="1.5" fill="#86909c"/>
</svg>
```

## 🔧 技术实现

### Table组件配置

```typescript
<Table
  columns={columns}
  data={mockData}
  rowKey="id"
  expandedRowKeys={expandedRowKey ? [expandedRowKey] : []}
  expandedRowRender={(record) => (
    // 详情面板内容
  )}
  expandProps={{
    expandRowByClick: false,  // 不允许点击行展开
    strictTreeData: false,
  }}
/>
```

### 关键配置说明

1. **expandedRowKeys**: 控制哪些行是展开的
   - 传入数组格式
   - 只包含一个元素（单行展开）
   - 为空数组时全部收起

2. **expandedRowRender**: 渲染展开内容
   - 接收当前行的record作为参数
   - 返回展开区域的JSX

3. **expandProps**:
   - `expandRowByClick: false` - 禁止点击整行展开
   - `strictTreeData: false` - 非严格树形数据模式

## 💡 优势对比

### 模态弹窗 vs 展开面板

| 特性 | 模态弹窗 | 展开面板 |
|------|----------|----------|
| 空间占用 | 覆盖整个页面 | 在表格中展开 |
| 上下文保持 | 脱离列表上下文 | 保持在列表中 |
| 操作便捷性 | 需要关闭弹窗 | 直接收起 |
| 多记录对比 | 困难 | 容易切换 |
| 移动端适配 | 需要额外处理 | 自适应 |
| 用户体验 | 中断式 | 流畅式 |

**展开面板的优势**:
- ✅ 不打断用户浏览流程
- ✅ 可以快速在多条记录间切换
- ✅ 保持列表上下文
- ✅ 更符合现代UI设计趋势
- ✅ 移动端友好

## 📱 响应式设计

展开面板会自动适应表格宽度：
- 外层表格宽度100%
- 内嵌表格继承容器宽度
- 列宽度使用固定值，确保一致性

## 🎨 样式定制

### 展开指示器（可选）
可以在表格左侧添加展开指示器：
```typescript
expandProps={{
  icon: ({ expanded }) => expanded ? '▼' : '▶',
  // ... 其他配置
}}
```

### 动画效果
Arco Design Table组件自带展开/收起的平滑动画效果。

## 🔌 数据对接建议

### 获取处置情况数据

当行展开时，可以动态加载该记录的处置情况：

```typescript
const handleViewDetail = async (record: any) => {
  if (expandedRowKey === record.id) {
    setExpandedRowKey(null)
  } else {
    setExpandedRowKey(record.id)
    // 加载该记录的处置情况数据
    try {
      const disposalData = await getDisposalDetails(record.id)
      setDisposalDataMap({
        ...disposalDataMap,
        [record.id]: disposalData
      })
    } catch (error) {
      Message.error('获取处置情况失败')
    }
  }
}
```

### API接口

```typescript
GET /api/forecast/comprehensive/:id/disposal

返回:
{
  code: 200,
  data: {
    list: [
      {
        status: string,
        createTime: string,
        // ... 其他字段
      }
    ]
  }
}
```

## 🧪 用户场景

### 场景1：查看单条记录详情
1. 用户在列表中找到目标记录
2. 点击详情图标
3. 下方展开显示处置情况
4. 查看完毕后点击图标收起

### 场景2：对比多条记录
1. 点击记录A的详情图标，展开
2. 查看记录A的处置情况
3. 点击记录B的详情图标
4. 记录A自动收起，记录B展开
5. 快速切换查看不同记录

### 场景3：空数据状态
- 展开后如果没有处置情况数据
- 显示"暂无数据"的空状态提示
- 保持良好的用户体验

## 📝 最佳实践

1. **性能优化**: 只在展开时加载详情数据，避免一次性加载所有数据
2. **加载状态**: 展开时显示loading状态
3. **错误处理**: 加载失败时显示友好的错误提示
4. **数据缓存**: 已加载的数据可以缓存，避免重复请求
5. **键盘操作**: 考虑支持键盘上下键切换展开的行

## 🎯 当前状态

- ✅ 表格可展开/收起功能
- ✅ 单行展开控制
- ✅ 展开面板样式
- ✅ 处置情况子表格
- ✅ 空数据状态展示
- ✅ 三点菜单图标
- ⏳ 待对接处置情况数据API
- ⏳ 待实现加载状态
- ⏳ 待实现操作菜单功能

## 🔍 与原设计对比

**改进前**:
- 使用Modal模态弹窗
- 点击后弹出覆盖层
- 需要手动关闭

**改进后**:
- 使用展开行方式
- 点击后在下方展开
- 保持在页面流程中
- 符合用户提供的设计图

现在的实现完全符合用户提供的设计稿！

